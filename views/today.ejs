<%- include('./partials/header') %>
<%- include('./partials/nav') %>

<div class="container-lg">
<% let today = new Date() %>
<% today.setHours(0,0,0,0) %>
<h2><%= today.toDateString() %></h2>
</div>

<div class="container-lg">
  <h6>Current Goal:</h6>
  <% if (goals) { %>
    <h6>ya we got goals</h6>
    <% goals.forEach(function(g) { %>
      <% if (g.active === true) { %>
      <%= g.name %>
     <% } %>
    <% }); %>
  <% } else { %>
    <h6>No Active Yet</h6>
  <% } %>
</div>

<div class="container-lg">
  <h6>Today's Action Items</h6>
  <% if (tasks) { %>
    <h6>ya we got tasks</h6>
    <table>
    <% tasks.forEach(function(t) { %>
      <% if (t.dueDate) { %>
      <% if (t.dueDate.setHours(0,0,0,0) <= today && t.done === false) { %>
        <tr>
        <td>        
          <form action="/tasks/isdone/<%= t._id %>?_method=PUT" method="POST">
          <input type="checkbox" name="done"
          <% if (t.done) { %>
          <%= ' checked ' %> 
          <% } %>
          onChange="this.form.submit()">
          </form>
        </td>
        <td><%= t.name %></td>
        <td><%= t.dueDate.toDateString() %></td>
        </tr>
      <% } %>
      <% } %>
     <% }) %>
    </table>
  <% } else { %>
    <h6>No Tasks Yet</h6>
  <% } %>
</div>

<div class="container-lg">
  <h6>Journal</h6>

  <form id="new-form" action="/journals" method="POST">
    <input type="text" name="content">
    <input type="submit" value="Submit Journal">
  </form>

</div>

<div class="container-lg">
  <h6>Habit Tracker</h6>
  <% if (habits) { %>
    <h6>ya we got habitz</h6>
    <table>
    <% habits.forEach(function(h) { %>
      <% if (h.frequency.includes(today.getDay())) { %>
        <tr>
        <td>        
          <form action="/habits/isdone/<%= h._id %>?_method=PUT" method="POST">
          <input type="checkbox" name="done" onChange="this.form.submit()"
          <% if (h.history.includes(today.toString())) { %>
          <%= ' checked ' %> 
          <% } %>
          >
          </form>
        </td>
        <td><%= h.name %></td>
        </tr>
      <% } %>
      <% }) %>
    </table>
  <% } else { %>
  <h6>No Habits Today </h6>
  <% } %>
</div>

<%- include('./partials/footer') %>